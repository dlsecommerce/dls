module.exports=[22267,a=>{"use strict";var b=a.i(87924),c=a.i(46271),d=a.i(50944),e=a.i(74167),f=a.i(72131),g=a.i(21520),h=a.i(1299),i=a.i(5623);let j=({value:a})=>{let d=(0,g.useMotionValue)(0),e=(0,h.useTransform)(d,a=>a.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}));return(0,f.useEffect)(()=>(0,i.animate)(d,a,{duration:1,ease:"easeInOut"}).stop,[a]),(0,b.jsx)(c.motion.span,{children:e})};var k=a.i(49447);let l=({text:a})=>(0,b.jsxs)("div",{className:"relative group flex items-center",children:[(0,b.jsx)(k.HelpCircle,{className:"w-4 h-4 text-neutral-400 cursor-pointer"}),(0,b.jsx)("div",{className:"absolute left-6 top-1/2 -translate-y-1/2 text-neutral-400/70 text-xs whitespace-nowrap font-normal opacity-0 group-hover:opacity-100 transition pointer-events-none z-20",children:a})]});var m=a.i(62036),n=a.i(17545),o=a.i(15618),p=a.i(66718),q=a.i(70430),r=a.i(94202);let s=({text:a})=>(0,b.jsxs)("div",{className:"relative group flex items-center",children:[(0,b.jsx)(k.HelpCircle,{className:"w-4 h-4 text-neutral-400 cursor-pointer"}),(0,b.jsx)("div",{className:"absolute left-6 top-1/2 -translate-y-1/2 text-neutral-400/70 text-xs whitespace-nowrap font-normal opacity-0 group-hover:opacity-100 transition pointer-events-none z-20",children:a})]}),t=({composicao:a,setComposicao:d,custoTotal:g,AnimatedNumber:h})=>{let i=(0,f.useRef)([]),[j,k]=(0,f.useState)([]),[l,t]=(0,f.useState)(null),[u,v]=(0,f.useState)(-1),w=(0,f.useRef)(null),x=async(a,b)=>{if(!a.trim())return void k([]);let{data:c,error:d}=await e.supabase.from("custos").select('"C√≥digo", "Custo Atual"').ilike('"C√≥digo"',`%${a}%`).limit(6);d?console.error("Erro ao buscar custos:",d):(t(b),k(c?.map(a=>({codigo:a["C√≥digo"],custo:Number(a["Custo Atual"])||0}))||[]),v(0))},y=(b,c,e)=>{let f=[...a];f[e].codigo=b,f[e].custo=c.toFixed(2),d(f),k([]),t(null),v(-1)};return(0,f.useEffect)(()=>{let a=a=>{w.current?.contains(a.target)||(k([]),t(null))};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),(0,b.jsxs)(c.motion.div,{className:"lg:col-span-7 p-2 rounded-xl bg-white/5 border border-white/10 backdrop-blur-lg shadow-lg h-full relative",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(n.Layers,{className:"w-5 h-5 text-[#1a8ceb]"}),(0,b.jsxs)("h3",{className:"text-base font-bold text-white flex items-center gap-2",children:["Composi√ß√£o ",(0,b.jsx)(s,{text:"Composi√ß√£o de Custos."})]})]}),(0,b.jsx)("div",{className:`space-y-1.5 ${a.length>10?"max-h-[360px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-[#1a8ceb]/30 scrollbar-track-transparent":""}`,children:(0,b.jsx)(m.AnimatePresence,{initial:!1,children:a.map((e,f)=>{let g;return(0,b.jsxs)(c.motion.div,{layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15},className:"relative grid grid-cols-3 gap-2 mb-1 p-1.5 rounded-lg bg-black/30 border border-white/10",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(q.Label,{className:"text-neutral-400 text-[10px] mb-1 block",children:"C√≥digo"}),(0,b.jsx)(p.Input,{ref:a=>{i.current[f]||(i.current[f]=[]),i.current[f][0]=a},value:e.codigo,placeholder:"SKU",onChange:b=>{let c=[...a];c[f].codigo=b.target.value,d(c),x(b.target.value,f)},onKeyDown:a=>{let b=a.currentTarget,c=b.selectionStart??0,d=b.selectionEnd??0,e=b.value.length;if(l===f&&j.length>0){if("ArrowDown"===a.key){a.preventDefault(),v(a=>a<j.length-1?a+1:0);return}if("ArrowUp"===a.key){a.preventDefault(),v(a=>a>0?a-1:j.length-1);return}if("Enter"===a.key){a.preventDefault();let b=j[u];b&&y(b.codigo,b.custo,f);return}if("Escape"===a.key){k([]),t(null);return}}if("ArrowDown"===a.key){a.preventDefault(),i.current[f+1]?.[0]?.focus();return}if("ArrowUp"===a.key){a.preventDefault(),i.current[f-1]?.[0]?.focus();return}if("ArrowRight"===a.key&&d===e){a.preventDefault(),i.current[f]?.[1]?.focus();return}if("ArrowLeft"===a.key&&0===c){a.preventDefault(),i.current[f]?.[2]?.focus();return}},className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]"}),l===f&&j.length>0&&(0,b.jsx)("div",{ref:w,className:"absolute z-50 mt-1 bg-[#0f0f0f] border border-white/10 rounded-md shadow-lg w-full max-h-40 overflow-y-auto",children:j.map((a,c)=>(0,b.jsxs)("div",{className:`px-2 py-1 text-xs text-white cursor-pointer flex justify-between ${c===u?"bg-[#1a8ceb]/30":"hover:bg-[#1a8ceb]/20"}`,onClick:()=>y(a.codigo,a.custo,f),children:[(0,b.jsx)("span",{children:a.codigo}),(0,b.jsxs)("span",{className:"text-[#1a8ceb]",children:["R$ ",a.custo.toFixed(2)]})]},c))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{className:"text-neutral-400 text-[10px] mb-1 block",children:"Quantidade"}),(0,b.jsx)(p.Input,{ref:a=>{i.current[f]||(i.current[f]=[]),i.current[f][1]=a},value:e.quantidade,placeholder:"1",onChange:b=>{let c=[...a];c[f].quantidade=b.target.value,d(c)},className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]"})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(q.Label,{className:"text-neutral-400 text-[10px] mb-1 block",children:"Custo (R$)"}),(0,b.jsx)(p.Input,{ref:a=>{i.current[f]||(i.current[f]=[]),i.current[f][2]=a},value:isNaN(g=parseFloat(String(e.custo).replace(",",".")))?"":g.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}),placeholder:"100,00",onChange:b=>{let c=[...a];c[f].custo=b.target.value,d(c)},className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]"}),f>=1&&(0,b.jsx)(r.Button,{onClick:()=>d(a=>a.filter((a,b)=>b!==f)),size:"sm",variant:"ghost",className:"absolute top-0 right-0 translate-x-1/2 -translate-y-1/2   w-5 h-5 p-0 flex items-center justify-center    bg-red-500/20 hover:bg-red-500/40 text-red-400    border border-red-500/30 rounded-full shadow-sm    transition-all cursor-pointer",title:"Remover linha",children:"√ó"})]})]},f)})})}),(0,b.jsxs)(r.Button,{onClick:()=>d(a=>[...a,{codigo:"",quantidade:"",custo:""}]),variant:"outline",className:"w-full border-white/10 text-white text-xs hover:bg-white/5 hover:border-[#1a8ceb]/50 rounded-xl transition-all mt-2",children:[(0,b.jsx)(o.Plus,{className:"w-3 h-3 mr-2"})," Incluir Custos"]}),(0,b.jsx)("div",{className:"mt-3 p-3 bg-gradient-to-br from-[#1a8ceb]/20 to-[#1a8ceb]/5 rounded-xl border border-[#1a8ceb]/30",children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,b.jsx)("span",{className:"text-neutral-300 text-xs mb-1",children:"Custo Total"}),(0,b.jsxs)("span",{className:"text-xl font-bold text-white",children:["R$ ",(0,b.jsx)(h,{value:g})]})]})})]})};var u=a.i(210),v=a.i(28193),w=a.i(83497),x=a.i(14548),y=a.i(81560),z=a.i(80701),A=a.i(14574);function B({open:a,onOpenChange:d,onConfirm:e,saving:f}){return(0,b.jsx)(A.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(A.DialogContent,{className:"bg-[#0f0f0f]/95 backdrop-blur-xl border border-neutral-700 rounded-2xl text-white max-w-md shadow-2xl",children:[(0,b.jsx)(A.DialogHeader,{children:(0,b.jsxs)(A.DialogTitle,{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,b.jsx)(x.Save,{className:"w-5 h-5 text-[#1a8ceb]"}),"Confirmar Salvamento"]})}),(0,b.jsxs)(c.motion.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"mt-3 space-y-3",children:[(0,b.jsx)("p",{className:"text-neutral-300",children:"Deseja realmente salvar as altera√ß√µes deste an√∫ncio?"}),(0,b.jsxs)("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-3 text-sm text-blue-300 flex items-start gap-2",children:[(0,b.jsx)(x.Save,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{className:"text-blue-400",children:"Dica:"})," Verifique todos os campos antes de confirmar o salvamento."]})]})]}),(0,b.jsxs)(A.DialogFooter,{className:"mt-5 flex justify-end gap-3",children:[(0,b.jsx)(r.Button,{variant:"outline",type:"button",className:"border-neutral-700 text-white hover:scale-105 transition-all cursor-pointer",onClick:()=>d(!1),disabled:f,children:"Cancelar"}),(0,b.jsx)(r.Button,{type:"button",className:`bg-gradient-to-r from-[#1a8ceb] to-[#1472c4] hover:scale-105 text-white flex items-center gap-2 cursor-pointer ${f?"opacity-80 cursor-wait":""}`,onClick:()=>{e(),d(!1)},disabled:f,children:f?(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(v.Loader,{className:"w-5 h-5 animate-spin"})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(x.Save,{className:"w-5 h-5"}),"Salvar"]})})]})]})})}let C=({produto:a,setProduto:d,router:e,saving:g,handleSave:h,HelpTooltip:i,setComposicao:j,setCustoTotal:k})=>{let l=!!a?.id,[m,n]=(0,f.useState)(!1),[o,r]=(0,f.useState)(!1);return(0,f.useEffect)(()=>{if(!l)return;let b=a?.id_var?.trim()?.toLowerCase()||"",c="simples"===b||""===b?"simples":"variacoes";a.tipo_anuncio!==c&&d(a=>({...a,tipo_anuncio:c}))},[a?.id_var,l,d,a?.tipo_anuncio]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B,{open:o,onOpenChange:r,onConfirm:h,saving:g}),(0,b.jsxs)("div",{className:"p-3 rounded-xl bg-black/30 border border-white/10",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Package,{className:"w-5 h-5 text-[#1a8ceb]"}),(0,b.jsxs)("h3",{className:"text-base font-bold text-white flex items-center gap-2",children:["Informa√ß√µes Gerais",(0,b.jsx)(i,{text:"Identifica√ß√£o do An√∫ncio."})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(c.motion.button,{whileTap:{scale:.9},onClick:()=>e.push("/dashboard/anuncios"),title:"Voltar",className:"p-2 hover:bg-white/10 rounded-full transition-all",children:(0,b.jsx)(u.ArrowLeft,{className:"w-4 h-4 text-white opacity-70 hover:opacity-100"})}),(0,b.jsx)(c.motion.button,{whileTap:{scale:.9,rotate:-15},onClick:()=>{window.confirm("Tem certeza que deseja limpar todos os campos? Essa a√ß√£o n√£o pode ser desfeita.")&&(n(!0),d(a=>({id:a.id||"",loja:"",id_bling:"",referencia:"",id_tray:"",id_var:"",od:"",nome:"",marca:"",categoria:"",tipo_anuncio:l?a.tipo_anuncio:""})),j&&j([{codigo:"",quantidade:"",custo:""}]),k&&k(0),setTimeout(()=>n(!1),600))},disabled:m,title:"Limpar todos os dados (somente interface)",className:`p-2 rounded-full transition-all ${m?"bg-red-500/20 text-red-300 cursor-not-allowed":"hover:bg-red-500/10 text-red-400 hover:text-red-500"}`,children:(0,b.jsx)(y.Trash2,{className:`w-4 h-4 transition-transform ${m?"animate-pulse":""}`})}),(0,b.jsx)(c.motion.button,{whileTap:{scale:.95},onClick:()=>r(!0),disabled:g,title:"Salvar altera√ß√µes",className:`p-2 rounded-full transition-all ${g?"bg-white/10 cursor-wait":"hover:bg-white/10"}`,children:g?(0,b.jsx)(v.Loader,{className:"w-4 h-4 text-white animate-spin"}):(0,b.jsx)(x.Save,{className:"w-4 h-4 text-white opacity-70 hover:opacity-100"})})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-2",children:[[{label:"Loja",key:"loja"},{label:"ID Bling",key:"id_bling"},{label:"Refer√™ncia",key:"referencia"},{label:"ID Tray",key:"id_tray"},{label:"ID Var",key:"id_var"},{label:"OD",key:"od"},{label:"Nome",key:"nome"},{label:"Marca",key:"marca"},{label:"Categoria",key:"categoria"}].map(c=>(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{className:"text-neutral-400 text-[10px] block mb-1",children:c.label}),(0,b.jsx)(p.Input,{type:"text",value:a?.[c.key]??"",onChange:a=>d(b=>({...b,[c.key]:a.target.value})),className:"bg-white/5 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb]"})]},c.key)),l&&(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{className:"text-neutral-400 text-[10px] block mb-1",children:"Tipo de An√∫ncio"}),(0,b.jsxs)(z.Select,{value:a?.tipo_anuncio??"",onValueChange:a=>d(b=>({...b,tipo_anuncio:a})),children:[(0,b.jsx)(z.SelectTrigger,{className:"bg-white/5 border-white/10 text-white text-xs rounded-md",children:(0,b.jsx)(z.SelectValue,{placeholder:"Selecione"})}),(0,b.jsxs)(z.SelectContent,{className:"bg-[#0f0f0f] border-white/10 text-white",children:[(0,b.jsx)(z.SelectItem,{value:"simples",children:"Simples"}),(0,b.jsx)(z.SelectItem,{value:"variacoes",children:"Com Varia√ß√µes"})]})]})]})]})]})]})};var D=a.i(3544);let E=({produto:a,setProduto:c,HelpTooltip:d})=>(0,b.jsxs)("div",{className:"p-3 rounded-xl bg-black/30 border border-white/10",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(D.Ruler,{className:"w-5 h-5 text-[#1a8ceb]"}),(0,b.jsxs)("h3",{className:"text-base font-bold text-white flex items-center gap-2",children:["Peso e Medidas ",(0,b.jsx)(d,{text:"Dimens√µes do An√∫ncio."})]})]}),(0,b.jsx)("div",{className:"grid md:grid-cols-2 gap-2",children:[{label:"Peso (g)",key:"peso"},{label:"Altura (cm)",key:"altura"},{label:"Largura (cm)",key:"largura"},{label:"Comprimento (cm)",key:"comprimento"}].map(d=>(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{className:"text-neutral-400 text-[10px] block mb-1",children:d.label}),(0,b.jsx)(p.Input,{type:"text",placeholder:"0,00",value:a?.[d.key]??"",onChange:a=>{var b,e;return b=d.key,e=a.target.value,void c(a=>({...a,[b]:e}))},onBlur:a=>{var b,e;let f;return b=d.key,f=(e=a.target.value)?e.replace(/\./g,"").replace(",","."):"",void c(a=>({...a,[b]:f}))},className:"bg-white/5 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]"})]},d.key))})]});var F=a.i(63771),G=a.i(20005);function H({open:a,onOpenChange:d,onConfirm:e}){let[g,h]=(0,f.useState)(!1),i=async()=>{h(!0),await new Promise(a=>setTimeout(a,800)),e(),h(!1),d(!1)};return(0,b.jsx)(A.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(A.DialogContent,{className:"bg-[#0f0f0f]/95 backdrop-blur-xl border border-neutral-700 rounded-2xl text-white max-w-md shadow-2xl",children:[(0,b.jsx)(A.DialogHeader,{children:(0,b.jsxs)(A.DialogTitle,{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,b.jsx)(G.LogOut,{className:"w-5 h-5 text-[#e74c3c]"}),"Deseja mesmo voltar?"]})}),(0,b.jsxs)(c.motion.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"mt-3 space-y-3",children:[(0,b.jsx)("p",{className:"text-neutral-300",children:"As altera√ß√µes n√£o salvas ser√£o perdidas. Confirma a sa√≠da desta p√°gina?"}),(0,b.jsxs)("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-3 text-sm text-red-300",children:[(0,b.jsx)("strong",{className:"text-red-400",children:"Aviso:"})," Essa a√ß√£o n√£o pode ser desfeita."]})]}),(0,b.jsxs)(A.DialogFooter,{className:"mt-5 flex justify-end gap-3",children:[(0,b.jsx)(r.Button,{variant:"outline",type:"button",className:"border-neutral-700 text-white hover:scale-105 transition-all cursor-pointer",onClick:()=>d(!1),disabled:g,children:"Cancelar"}),(0,b.jsx)(r.Button,{type:"button",className:`bg-gradient-to-r from-[#e74c3c] to-[#c0392b] text-white cursor-pointer transition-all ${g?"opacity-80 cursor-wait":"hover:scale-105"}`,onClick:i,disabled:g,children:g?(0,b.jsx)(v.Loader,{className:"w-5 h-5 animate-spin text-white"}):"Voltar"})]})]})})}var I=a.i(81422);let J=a=>{if(null==a||""===a)return 0;if("number"==typeof a)return a;let b=String(a).trim(),c=(b=b.replace(/[^\d.,-]/g,"")).includes(","),d=b.includes(".");c&&d?b=b.lastIndexOf(",")>b.lastIndexOf(".")?(b=b.replace(/\./g,"")).replace(",","."):b.replace(/,/g,""):c&&(b=(b=b.replace(/\./g,"")).replace(",","."));let e=parseFloat(b);return isNaN(e)?0:e},K=a=>{let b=(a||"").trim().toUpperCase();return b.startsWith("PAI")?1:b.startsWith("VAR")?2:3};async function L(a){if(0===a.length)return{};let{data:b,error:c}=await e.supabase.from("custos").select("*").in("C√≥digo",a),d=b||[];if(c||0===d.length){let b=await e.supabase.from("custos").select("*").in("Codigo",a);!b.error&&b.data&&(d=b.data)}let f={},g=new Set;for(let a of d){let b=(a.C√≥digo||a.Codigo||"").toString().trim(),c=J(a["Custo Atual"]??a.Custo_Atual??a.custo??0);b&&(f[b]=isNaN(c)?0:c,g.add(b))}let h=a.filter(a=>!g.has(a));if(h.length>0){let a=h.map(a=>({C√≥digo:a,"Custo Atual":0})),{error:b}=await e.supabase.from("custos").insert(a);b?console.warn("‚ö†Ô∏è Erro ao inserir novos custos:",b):console.info(`‚úÖ Custos criados para c\xf3digos: ${h.join(", ")}`),h.forEach(a=>f[a]=0)}return f}function M(){let a=(0,d.useRouter)(),g=(0,d.useSearchParams)(),h=g.get("id")||void 0;g.get("loja");let i=(0,f.useRef)(null),{produto:k,setProduto:m,composicao:n=[],setComposicao:o,custoTotal:q,setCustoTotal:r,loading:s,toInternal:u,toDisplay:v}=h?function(a){let[b,c]=(0,f.useState)(null),[g,h]=(0,f.useState)(!1),i=(0,d.useSearchParams)().get("loja"),{composicao:j,setComposicao:k,custoTotal:l,setCalculo:m,setAcrescimos:n}=(0,I.usePrecificacao)(),o=(0,f.useCallback)(async()=>{if(a&&i){h(!0);try{let b="Pikot Shop"===i?"Pikot Shop":"S√≥baquetas"===i||"Sobaquetas"===i?"S√≥baquetas":null;if(!b)return;let d="Pikot Shop"===b?"PK":"SB",{data:f,error:g}=await e.supabase.from("Pikot Shop"===b?"anuncios_pk":"anuncios_sb").select("*").eq("ID",String(a).trim()).eq("Loja",d).limit(1);if(g)return void console.error("‚ùå Erro ao buscar an√∫ncio:",g);if(!f||0===f.length){console.warn("‚ö†Ô∏è Nenhum dado encontrado para ID:",a,"Loja:",d),c(null);return}let h=f[0],j=K(h["Refer√™ncia"]);c({id:h.ID,loja:b,od:j,id_bling:h["ID Bling"]??null,id_tray:h["ID Tray"]??null,id_var:h["ID Var"]??null,referencia:h["Refer√™ncia"]??null,nome:h.Nome??null,marca:h.Marca??null,categoria:h.Categoria??null,peso:J(h.Peso),altura:J(h.Altura),largura:J(h.Largura),comprimento:J(h.Comprimento)});let l=[];for(let a=1;a<=10;a++){let b=h[`C\xf3digo ${a}`],c=h[`Quantidade ${a}`];b&&l.push({codigo:String(b).trim(),quantidade:c&&""!==c?String(c).replace(".",","):"1",custo:"0,00"})}let o=l.map(a=>a.codigo),p=await L(o),q=l.map(a=>{var b;return{...a,custo:null==(b=p[a.codigo]??0)||isNaN(Number(b))?"0,00":Number(b).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}});k(q),n(a=>({...a,acrescimo:0}));let r=q.reduce((a,b)=>a+J(b.quantidade)*J(b.custo),0);m(a=>({...a,custo:String(r),frete:a?.frete??"0"}))}finally{h(!1)}}},[a,i,k,n,m]);return(0,f.useEffect)(()=>{a&&i&&o()},[a,i,o]),{produto:b,setProduto:c,composicao:j,setComposicao:k,custoTotal:l,loading:g,carregarAnuncio:o}}(h):function(){let a=(0,d.useRouter)(),b=(0,d.useSearchParams)(),c=b.get("id"),g=b.get("loja"),[h,i]=(0,f.useState)(!1),[j,k]=(0,f.useState)(!1),[l,m]=(0,f.useState)(!1),[n,o]=(0,f.useState)({ID:"",Loja:"Pikot Shop","ID Bling":"","ID Tray":"","ID Var":"",Refer√™ncia:"",Nome:"",Marca:"",Categoria:"",Peso:"",Altura:"",Largura:"",Comprimento:"",OD:""}),[p,q]=(0,f.useState)([]),[r,s]=(0,f.useState)(0);(0,f.useEffect)(()=>{s(p.reduce((a,b)=>a+(parseFloat(b.quantidade)||0)*(parseFloat(String(b.custo).replace(",","."))||0),0))},[p]);let t=(0,f.useCallback)(async a=>{try{let{data:b,error:c}=await e.supabase.from("Pikot Shop"===a?"anuncios_pk":"anuncios_sb").select("ID").order("ID",{ascending:!1}).limit(1).maybeSingle();if(c)throw c;let d={ID:(b?.ID?parseInt(b.ID):0)+1,Loja:a,"ID Bling":"","ID Tray":"","ID Var":"",Refer√™ncia:"",Nome:"",Marca:"",Categoria:"",Peso:"",Altura:"",Largura:"",Comprimento:"",OD:""};return o(d),q([]),s(0),d}catch(a){return alert("Erro ao criar novo produto: "+(a.message||a)),null}},[]),u=(0,f.useCallback)(async(b,c,d)=>{try{i(!0);let f="Pikot Shop"===b.loja?"PK":"SB",g="Pikot Shop"===b.loja?"anuncios_pk":"anuncios_sb";if(!g)return void alert("Loja inv√°lida.");let h={};c.forEach((a,b)=>{let c=b+1,d=J(a.quantidade);h[`C\xf3digo ${c}`]=a.codigo||null,h[`Quantidade ${c}`]=isNaN(d)?null:d});let j=K(b.referencia),k={ID:String(b.id||b.ID),Loja:f,"ID Bling":b.id_bling||null,"ID Tray":b.id_tray||null,"ID Var":b.id_var||null,Refer√™ncia:b.referencia||null,Nome:b.nome||null,Marca:b.marca||null,Categoria:b.categoria||null,Peso:b.peso||null,Altura:b.altura||null,Largura:b.largura||null,Comprimento:b.comprimento||null,OD:j||null,...h},{data:l}=await e.supabase.from(g).select("ID").eq("ID",k.ID).eq("Loja",f).maybeSingle(),m=null;if(l){let{error:a}=await e.supabase.from(g).update(k).eq("ID",k.ID).eq("Loja",f);m=a}else{let{error:a}=await e.supabase.from(g).insert(k);m=a}if(m)throw m;alert("‚úÖ An√∫ncio salvo com sucesso!"),d?d():a.push("/dashboard/anuncios")}catch(a){alert("Erro ao salvar an√∫ncio: "+(a.message||a))}finally{i(!1)}},[a]),v=(0,f.useCallback)(async b=>{if(!b?.ID&&!b?.id)return void alert("Produto inv√°lido para exclus√£o.");try{k(!0);let c="Pikot Shop"===b.loja?"PK":"SB",d="Pikot Shop"===b.loja?"anuncios_pk":"anuncios_sb",f=String(b.ID||b.id).trim(),{error:g}=await e.supabase.from(d).delete().eq("ID",f).eq("Loja",c);if(g)throw g;alert("üóëÔ∏è An√∫ncio exclu√≠do com sucesso!"),a.push("/dashboard/anuncios")}catch(a){alert("Erro ao excluir an√∫ncio: "+(a.message||a))}finally{k(!1)}},[a]);return(0,f.useEffect)(()=>{(async()=>{if(c&&g){m(!0);try{let a=g.toLowerCase(),b=a.includes("pikot")?"anuncios_pk":a.includes("sobaquetas")?"anuncios_sb":null;if(!b)return void alert("Loja inv√°lida.");let{data:d,error:f}=await e.supabase.from(b).select("*").eq("ID",c).maybeSingle();if(f)throw f;d&&o(d)}catch(a){alert("Erro ao carregar an√∫ncio: "+(a.message||a))}finally{m(!1)}}})()},[c,g]),{produto:n,setProduto:o,composicao:p,setComposicao:q,custoTotal:r,setCustoTotal:s,handleCreate:t,handleSave:u,handleDelete:v,saving:h,deleting:j,loading:l,toInternal:a=>a,toDisplay:a=>a}}(),{handleSave:w,handleDelete:x,saving:y,deleting:z}=function(){let[a,b]=(0,f.useState)(!1),[c,g]=(0,f.useState)(!1),h=(0,d.useRouter)(),i=(0,f.useCallback)(async(a,c,d)=>{if(!a?.loja)return void alert("Selecione uma loja antes de salvar (Pikot Shop ou S√≥baquetas).");b(!0);try{let b,f="Pikot Shop"===a.loja?"anuncios_pk":"S√≥baquetas"===a.loja?"anuncios_sb":null,g="Pikot Shop"===a.loja?"PK":"SB";if(!f)throw Error("Loja inv√°lida. Selecione Pikot Shop ou S√≥baquetas.");let i={};c.forEach((a,b)=>{let c=b+1,d=J(a.quantidade);i[`C\xf3digo ${c}`]=a.codigo||null,i[`Quantidade ${c}`]=isNaN(d)?null:d});let j=K(a.referencia),k=a.id?Number(a.id):null;if(!k){let{data:a,error:b}=await e.supabase.from(f).select("ID").order("ID",{ascending:!1}).limit(1).maybeSingle();if(b)throw b;k=(a?.ID?Number(a.ID):0)+1}let l={ID:String(k).trim(),Loja:g,"ID Bling":a.id_bling||null,"ID Tray":a.id_tray||null,"ID Var":a.id_var||null,Refer√™ncia:a.referencia||null,Nome:a.nome||null,Marca:a.marca||null,Categoria:a.categoria||null,Peso:a.peso||null,Altura:a.altura||null,Largura:a.largura||null,Comprimento:a.comprimento||null,OD:j||null,...i},{data:m,error:n}=await e.supabase.from(f).select("ID").eq("ID",String(k)).eq("Loja",g).maybeSingle();if(n)throw n;if(m){let{error:a}=await e.supabase.from(f).update(l).eq("ID",String(k)).eq("Loja",g);b=a}else{let{error:a}=await e.supabase.from(f).insert(l);b=a}if(b)throw b;d?d():h.push("/dashboard/anuncios")}catch(a){alert("Erro ao salvar an√∫ncio: "+(a.message||a))}finally{b(!1)}},[h]);return{handleSave:i,handleDelete:(0,f.useCallback)(async(a,b)=>{if(!a?.id||!a?.loja)return void alert("Produto ou loja inv√°lida para exclus√£o.");g(!0);try{let c="Pikot Shop"===a.loja?"anuncios_pk":"S√≥baquetas"===a.loja?"anuncios_sb":null,d="Pikot Shop"===a.loja?"PK":"SB";if(!c)throw Error("Loja inv√°lida para exclus√£o.");let{error:f}=await e.supabase.from(c).delete().eq("ID",String(a.id).trim()).eq("Loja",d);if(f)throw f;b?b():h.push("/dashboard/anuncios")}catch(a){alert("Erro ao excluir an√∫ncio: "+(a.message||a))}finally{g(!1)}},[h]),handleDeleteSelected:(0,f.useCallback)(async(a,b)=>{if(!a?.length)return void alert("Nenhum an√∫ncio selecionado para exclus√£o.");g(!0);try{let c=a.reduce((a,b)=>{let c=(b.loja||b.Loja||"").toString().toLowerCase(),d="";return c.includes("pikot")||"pk"===c?d="anuncios_pk":(c.includes("sobaquetas")||c.includes("s√≥baquetas")||"sb"===c)&&(d="anuncios_sb"),d&&(a[d]=a[d]||[],a[d].push(String(b.id||b.ID).trim())),a},{}),d=Object.entries(c).map(async([a,b])=>{let{error:c}=await e.supabase.from(a).delete().in("ID",b);if(c)throw c});await Promise.all(d),b&&b()}catch(a){alert("Erro ao excluir an√∫ncios: "+(a.message||a))}finally{g(!1)}},[]),saving:a,deleting:c}}(),{sugestoes:A,setSugestoes:B,campoAtivo:D,setCampoAtivo:G,indiceSelecionado:M,setIndiceSelecionado:N,listaRef:O,buscarSugestoes:P}=(()=>{let[a,b]=(0,f.useState)([]),[c,d]=(0,f.useState)(null),[g,h]=(0,f.useState)(-1),i=(0,f.useRef)(null),j=async(a,c)=>{if(!a.trim())return void b([]);let{data:f,error:g}=await e.supabase.from("custos").select('"C√≥digo", "Custo Atual"').ilike('"C√≥digo"',`%${a}%`).limit(5);g?console.error("Erro ao buscar sugest√µes:",g):(d(c),b(f?.map(a=>({codigo:a["C√≥digo"],custo:Number(a["Custo Atual"])||0}))||[]),h(0))};return{sugestoes:a,setSugestoes:b,campoAtivo:c,setCampoAtivo:d,indiceSelecionado:g,setIndiceSelecionado:h,listaRef:i,buscarSugestoes:j}})(),{showExitModal:Q,confirmExit:R,setShowExitModal:S}=(({saving:a,handleSave:b,campoAtivo:c,sugestoesLength:e,numColunas:g=1})=>{let h=(0,d.useRouter)(),[i,j]=(0,f.useState)(!1);return(0,f.useRef)(!1),(0,f.useEffect)(()=>{let c=c=>{let d=document.activeElement,e=d?.tagName.toLowerCase();if(("input"===e||"textarea"===e||d?.getAttribute("role")==="combobox")&&"Escape"!==c.key&&"Enter"!==c.key)return;if((c.ctrlKey||c.metaKey)&&"s"===c.key.toLowerCase()){c.preventDefault(),a||b();return}if("Escape"===c.key)return(c.preventDefault(),c.stopPropagation(),i)?void j(!1):void j(!0);let f=Array.from(document.querySelectorAll('input:not([type="hidden"]), [role="combobox"], button, textarea, select, [tabindex]:not([tabindex="-1"])')).filter(a=>!a.hasAttribute("disabled")&&-1!==a.tabIndex);if(!f.length)return;let h=d?f.indexOf(d):-1,k=a=>{let b=Math.max(0,Math.min(f.length-1,h+a));f[b]?.focus()};if(g>1&&-1!==h){if("ArrowDown"===c.key){c.preventDefault();let a=h+g;a<f.length&&f[a].focus();return}if("ArrowUp"===c.key){c.preventDefault();let a=h-g;a>=0&&f[a].focus();return}}if("ArrowDown"===c.key){c.preventDefault(),k(1);return}if("ArrowUp"===c.key){c.preventDefault(),k(-1);return}"Enter"===c.key&&d&&"BUTTON"!==d.tagName&&("INPUT"===d.tagName||"combobox"===d.getAttribute("role")||"TEXTAREA"===d.tagName)&&(c.preventDefault(),k(1))};return window.addEventListener("keydown",c,{capture:!0}),()=>window.removeEventListener("keydown",c,{capture:!0})},[a,c,e,b,g,i]),{showExitModal:i,confirmExit:()=>{j(!1),h.back()},cancelExit:()=>j(!1),setShowExitModal:j}})({saving:y,handleSave:()=>w(k,n),campoAtivo:D,sugestoesLength:A.length});return((0,f.useEffect)(()=>{s?i.current?.start?.():i.current?.finish?.()},[s]),s)?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(F.LoadingBar,{ref:i}),(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen text-white",children:(0,b.jsx)("span",{className:"text-neutral-400 text-sm"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(F.LoadingBar,{ref:i}),(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0a] via-[#0f0f0f] to-[#0a0a0a] p-4 md:p-8 pt-24",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4",children:[(0,b.jsx)(t,{composicao:n,setComposicao:o,toInternal:u,toDisplay:v,custoTotal:q,AnimatedNumber:j,HelpTooltip:l,supabase:e.supabase,campoAtivo:D,setCampoAtivo:G,indiceSelecionado:M,setIndiceSelecionado:N,listaRef:O,sugestoes:A,setSugestoes:B,buscarSugestoes:P,anuncioData:k,setAnuncioData:m}),(0,b.jsxs)(c.motion.div,{className:"lg:col-span-5 p-2 rounded-xl bg-white/5 border border-white/10 backdrop-blur-lg shadow-lg flex flex-col gap-3 h-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},children:[(0,b.jsx)(C,{produto:k,setProduto:m,router:a,saving:y,handleSave:()=>w(k,n),handleDelete:()=>x(k),HelpTooltip:l,setComposicao:o,setCustoTotal:r}),(0,b.jsx)(p.Input,{type:"text",value:k?.id?.toString()??"",disabled:!0,className:"bg-white/5 border-white/10 text-white text-xs rounded-md opacity-70 cursor-not-allowed"}),(0,b.jsx)(E,{produto:k,setProduto:m,HelpTooltip:l})]})]})}),(0,b.jsx)(H,{open:Q,onOpenChange:S,onConfirm:R})]})}a.s(["default",()=>M],22267)}];

//# sourceMappingURL=src_components_announce_ProductDetails_ProductDetails_tsx_71e7a1b1._.js.map