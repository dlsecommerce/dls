module.exports=[67208,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(46271),e=a.i(17545),f=a.i(50944),g=a.i(21520),h=a.i(1299),i=a.i(5623);let j=({value:a})=>{let e=(0,g.useMotionValue)(0),f=(0,h.useTransform)(e,a=>a.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}));return(0,c.useEffect)(()=>(0,i.animate)(e,a,{duration:1,ease:"easeInOut"}).stop,[a]),(0,b.jsx)(d.motion.span,{children:f})};var k=a.i(70430),l=a.i(66718),m=a.i(94202);let n=({sugestoes:a,indiceSelecionado:c,selecionarSugestao:d,idx:e})=>(0,b.jsx)("div",{className:"absolute z-50 mt-1 bg-[#0f0f0f] border border-white/10 rounded-md shadow-lg w-full max-h-40 overflow-y-auto",children:a.map((a,f)=>(0,b.jsxs)("div",{onClick:()=>d(a.codigo,a.custo,e),className:`px-2 py-1 text-xs text-white cursor-pointer flex justify-between ${f===c?"bg-[#1a8ceb]/30":"hover:bg-[#1a8ceb]/20"}`,children:[(0,b.jsx)("span",{children:a.codigo}),(0,b.jsxs)("span",{className:"text-[#1a8ceb]",children:["R$ ",a.custo.toFixed(2)]})]},f))}),o=({item:a,idx:c,composicao:d,campoAtivo:e,sugestoes:f,indiceSelecionado:g,inputRefs:h,removerItem:i,setComposicao:j,buscarSugestoes:o,handleSugestoesKeys:p,selecionarSugestao:q,listaRef:r})=>(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-2 mb-1 p-1.5 rounded-lg bg-black/30 border border-white/10 relative",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(k.Label,{className:"text-neutral-400 text-[10px] mb-1 block",children:"Código"}),(0,b.jsx)(l.Input,{ref:a=>{h.current[c]=a},type:"text",placeholder:"SKU",value:a.codigo,onChange:a=>{let b=[...d];b[c].codigo=a.target.value,j(b),o(a.target.value,c)},onKeyDown:a=>p(a,c),className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb]"}),e===c&&f.length>0&&(0,b.jsx)("div",{ref:r,children:(0,b.jsx)(n,{sugestoes:f,indiceSelecionado:g,selecionarSugestao:q,idx:c})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Label,{className:"text-neutral-400 text-[10px] mb-1 block",children:"Quantidade"}),(0,b.jsx)(l.Input,{type:"text",placeholder:"1",value:a.quantidade,onChange:a=>{let b=[...d];b[c].quantidade=a.target.value,j(b)},className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Label,{className:"text-neutral-400 text-[10px] mb-1 block",children:"Custo (R$)"}),(0,b.jsx)(l.Input,{type:"text",placeholder:"100,00",value:a.custo,onChange:a=>{let b=[...d];b[c].custo=a.target.value,j(b)},className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb]"})]}),c>=1&&(0,b.jsx)(m.Button,{onClick:()=>i(c),size:"sm",variant:"ghost",className:"absolute top-0 right-0 translate-x-1/2 -translate-y-1/2   w-5 h-5 p-0 flex items-center justify-center    bg-red-500/20 hover:bg-red-500/40 text-red-400    border border-red-500/30 rounded-full shadow-sm    transition-all cursor-pointer",children:"×"})]});var p=a.i(15618);let q=({composicao:a,adicionarItem:c,removerItem:d,campoAtivo:e,sugestoes:f,indiceSelecionado:g,inputRefs:h,listaRef:i,setComposicao:j,buscarSugestoes:k,handleSugestoesKeys:l,selecionarSugestao:n})=>(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"space-y-2",children:a.map((c,m)=>(0,b.jsx)(o,{item:c,idx:m,composicao:a,campoAtivo:e,sugestoes:f,indiceSelecionado:g,inputRefs:h,listaRef:i,removerItem:d,setComposicao:j,buscarSugestoes:k,handleSugestoesKeys:l,selecionarSugestao:n},m))}),(0,b.jsxs)(m.Button,{onClick:c,variant:"outline",className:"w-full border-white/10 text-white text-xs hover:bg-white/5 hover:border-[#1a8ceb]/50 rounded-xl transition-all mt-2 flex items-center justify-center",children:[(0,b.jsx)(p.Plus,{className:"w-3 h-3 mr-2"}),"Incluir Custos"]})]});var r=a.i(24669);let s=({label:a,keyName:c,calculoLoja:d,setCalculoLoja:e,loading:f})=>(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsx)(k.Label,{className:"text-neutral-400 text-[10px] block mb-1",children:a}),(0,b.jsx)(l.Input,{type:"text",placeholder:"0,00",value:d[c]??"",disabled:f,onChange:a=>!f&&e({...d,[c]:a.target.value}),className:"bg-black/50 border border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb]"}),"desconto"===c&&(0,b.jsxs)("div",{className:"mt-1",children:[(0,b.jsx)(k.Label,{className:"text-neutral-400 text-[10px] block mb-1",children:"Embalagem (R$)"}),(0,b.jsx)(l.Input,{type:"text",placeholder:"0,00",value:d.embalagem??"",disabled:f,onChange:a=>!f&&e({...d,embalagem:a.target.value}),className:"bg-black/50 border border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb]"})]})]});var t=a.i(210),u=a.i(81560),v=a.i(14548),w=a.i(28193);let x=({saving:a,handleClearLocal:c,handleSave:e})=>{let g=(0,f.useRouter)();return(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(d.motion.button,{whileTap:{scale:.9},onClick:()=>g.push("/dashboard/marketplaces/tray"),title:"Voltar",className:"p-2 hover:bg-white/10 rounded-full transition-all",children:(0,b.jsx)(t.ArrowLeft,{className:"w-4 h-4 text-white opacity-70 hover:opacity-100"})}),(0,b.jsx)(d.motion.button,{whileTap:{scale:.9,rotate:-15},onClick:c,title:"Limpar todos os dados",className:"p-2 rounded-full transition-all hover:bg-red-500/10 text-red-400 hover:text-red-500",children:(0,b.jsx)(u.Trash2,{className:"w-4 h-4"})}),(0,b.jsx)(d.motion.button,{whileTap:{scale:.95},onClick:e,disabled:a,title:"Salvar alterações",className:`p-2 rounded-full transition-all ${a?"bg-white/10 cursor-wait":"hover:bg-white/10"}`,children:a?(0,b.jsx)(w.Loader,{className:"w-4 h-4 text-white animate-spin"}):(0,b.jsx)(v.Save,{className:"w-4 h-4 text-white opacity-70 hover:opacity-100"})})]})},y=({calculoLoja:a,setCalculoLoja:c,precoLoja:d,saving:e,handleClearLocal:f,handleSave:g,produto:h})=>(0,b.jsxs)("div",{className:"p-3 rounded-lg bg-black/30 border border-white/10",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(r.TrendingUp,{className:"w-5 h-5 text-[#1a8ceb]"}),(0,b.jsx)("h3",{className:"text-base font-bold text-white",children:"Cálculo de Preço"})]}),(0,b.jsx)(x,{saving:e,handleClearLocal:f,handleSave:g})]}),["desconto","frete","imposto","comissao","margem","marketing"].map(d=>(0,b.jsx)(s,{keyName:d,calculoLoja:a,setCalculoLoja:c,label:"margem"===d?"Margem de Lucro (%)":"frete"===d?"Frete (R$)":d.charAt(0).toUpperCase()+d.slice(1)+" (%)"},d)),(0,b.jsxs)("div",{className:"mt-3 text-center",children:[(0,b.jsx)("span",{className:"text-white text-xs",children:"Preço de Venda"}),(0,b.jsxs)("div",{className:"text-xl font-bold text-[#1a8ceb]",children:["R$ ",(0,b.jsx)(j,{value:d})]})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)("input",{type:"text",value:h?.id?.toString()??"",disabled:!0,className:"   w-full    bg-[#202020]   border border-white/10   rounded-md   text-white    text-sm   px-4    h-[40px]   opacity-80    cursor-not-allowed   focus:outline-none   "})})]});var z=a.i(3544);let A=({produto:a,setProduto:c,loading:d})=>(0,b.jsxs)("div",{className:"p-3 rounded-xl bg-black/30 border border-white/10",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(z.Ruler,{className:"w-5 h-5 text-[#1a8ceb]"}),(0,b.jsx)("h3",{className:"text-base font-bold text-white",children:"Peso e Medidas"})]}),(0,b.jsx)("div",{className:"grid md:grid-cols-2 gap-2",children:[{label:"Peso (g)",key:"peso",ph:"1000"},{label:"Altura (cm)",key:"altura",ph:"10"},{label:"Largura (cm)",key:"largura",ph:"20"},{label:"Comprimento (cm)",key:"comprimento",ph:"30"}].map(e=>(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Label,{className:"text-neutral-400 text-[10px] block mb-1",children:e.label}),(0,b.jsx)(l.Input,{type:"text",placeholder:e.ph,value:a?.[e.key]??"",disabled:d,onChange:a=>!d&&c(b=>({...b,[e.key]:a.target.value})),className:"bg-white/5 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb]"})]},e.key))})]});var B=a.i(83497),C=a.i(80701);let D=({produto:a,setProduto:c,loading:d})=>(0,b.jsxs)("div",{className:"mt-6 p-3 rounded-xl bg-white/5 border border-white/10 backdrop-blur-lg shadow-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(B.Package,{className:"w-5 h-5 text-[#1a8ceb]"}),(0,b.jsx)("h3",{className:"text-base font-bold text-white",children:"Informações Gerais"})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-2",children:[[{label:"Loja",key:"loja",ph:"Pikot Shop"},{label:"ID Bling",key:"id_bling",ph:"16564189746"},{label:"Referência",key:"referencia",ph:"TN 5AM"},{label:"ID Tray",key:"id_tray",ph:"2932555"},{label:"ID Var",key:"id_var",ph:"Simples"},{label:"OD",key:"od",ph:"1"},{label:"Nome",key:"nome",ph:"Baqueta Liverpool"},{label:"Marca",key:"marca",ph:"Liverpool"},{label:"Categoria",key:"categoria",ph:"Baqueta"}].map(e=>(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Label,{className:"text-neutral-400 text-[10px] block mb-1",children:e.label}),(0,b.jsx)(l.Input,{type:"text",placeholder:e.ph,value:a?.[e.key]??"",disabled:d,onChange:a=>!d&&c(b=>({...b,[e.key]:a.target.value})),className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb]"})]},e.key)),(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Label,{className:"text-neutral-400 text-[10px] block mb-1",children:"Tipo de Anúncio"}),(0,b.jsxs)(C.Select,{disabled:d,value:a?.tipo_anuncio??"",onValueChange:a=>!d&&c(b=>({...b,tipo_anuncio:a})),children:[(0,b.jsx)(C.SelectTrigger,{className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb]",children:(0,b.jsx)(C.SelectValue,{placeholder:"Selecione"})}),(0,b.jsxs)(C.SelectContent,{className:"bg-[#0f0f0f] border-white/10 text-white",children:[(0,b.jsx)(C.SelectItem,{value:"simples",children:"Simples"}),(0,b.jsx)(C.SelectItem,{value:"variacoes",children:"Com Variações"})]})]})]})]})]});var E=a.i(74167),F=a.i(81422);function G(){let a=(0,f.useSearchParams)(),g=a.get("id"),h=a.get("loja"),i=h?.toUpperCase()?.replace("Ó","O")?.replace("Ô","O")?.replace("Á","A")?.replace("Ã","A")?.replace("É","E")?.replace(/\s/g,"")?.trim(),{produto:k,setProduto:l,composicao:m,setComposicao:n,adicionarItem:o,removerItem:p,custoTotal:r,calculoLoja:s,setCalculoLoja:t,campoAtivo:u,sugestoes:v,indiceSelecionado:w,inputRefs:x,listaRef:z,buscarSugestoes:B,handleSugestoesKeys:C,selecionarSugestao:G}=function(a,b){let[d,e]=(0,c.useState)(!1),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)({id:"",loja:"",id_bling:"",id_tray:"",id_var:"",referencia:"",tipo_anuncio:"",od:"",nome:"",marca:"",categoria:"",peso:"",altura:"",largura:"",comprimento:"",embalagem:""}),[j,k]=(0,c.useState)({desconto:"",imposto:"",margem:"",frete:"",comissao:"",marketing:""}),{composicao:l,setComposicao:m,custoTotal:n,setCalculo:o,setAcrescimos:p,adicionarItem:q,removerItem:r}=(0,F.usePrecificacao)(),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(0),y=(0,c.useRef)(null),z=(0,c.useRef)([]),A=(0,c.useRef)(null),B=async(a,b)=>{A.current&&clearTimeout(A.current),A.current=setTimeout(async()=>{if(!a.trim())return void t([]);let{data:c,error:d}=await E.supabase.from("custos").select('"Código", "Custo Atual"').ilike('"Código"',`%${a}%`).limit(5);d?console.error("Erro ao buscar sugestões:",d):(v(b),t(c?.map(a=>({codigo:a["Código"],custo:Number(a["Custo Atual"])||0}))||[]),x(0))},10)},C=(a,b,c)=>{let d=[...l];d[c].codigo=a,d[c].custo=b.toFixed(2),m(d),t([]),v(null),setTimeout(()=>{z.current[c+1]?.focus?.()},50)},D=async a=>{let{data:b}=await E.supabase.from("marketplace_tray_all").select("*").eq("ID Tray",a).maybeSingle();if(b)return b;let{data:c}=await E.supabase.from("marketplace_tray_all").select("*").eq("ID Bling",a).maybeSingle();return c||null},G=async(a,b,c)=>{let d="SB"===c?"Sóbaquetas":"Pikot Shop";if(!isNaN(Number(a))){let{data:b}=await E.supabase.from("anuncios_all").select("*").eq("ID",Number(a)).eq("Loja",d).maybeSingle();if(b)return b}for(let[a,c]of[["ID Tray",b["ID Tray"]],["ID Bling",b["ID Bling"]],["ID Var",b["ID Var"]],["Referência",b["Referência"]]])if(c){let{data:b}=await E.supabase.from("anuncios_all").select("*").eq(a,c).eq("Loja",d).maybeSingle();if(b)return b}return null},H=(0,c.useCallback)(async()=>{if(!a||!b)return;e(!0);let c=await D(a);if(!c)return void e(!1);let d=await G(a,c,b),f=d?.OD??c.OD??"";if(!f&&d)for(let a=1;a<=10;a++){let b=d[`C\xf3digo ${a}`];if(b&&b.toUpperCase().includes("OD")){f=b;break}}i({id:a,loja:"SB"===b?"Sóbaquetas":"Pikot Shop",id_bling:c["ID Bling"]||"",id_tray:c["ID Tray"]||"",id_var:d?.["ID Var"]??c["ID Var"]??"",referencia:c["Referência"]||"",tipo_anuncio:function(a=""){let b=a.toUpperCase();return b.includes("PAI")||b.includes("VAR")?"variações":"simples"}(c["Referência"]),od:f,nome:c.Nome??"",marca:c.Marca??"",categoria:c.Categoria??"",peso:d?.Peso??"",altura:d?.Altura??"",largura:d?.Largura??"",comprimento:d?.Comprimento??"",embalagem:c.Embalagem??""}),k({desconto:c.Desconto??"",imposto:c.Imposto??"",margem:c["Margem de Lucro"]??"",frete:c.Frete??"",comissao:c["Comissão"]??"",marketing:c.Marketing??""});let g=[];if(d)for(let a=1;a<=10;a++){let b=d[`C\xf3digo ${a}`],c=d[`Quantidade ${a}`];b&&g.push({codigo:b.toString(),quantidade:(c??1).toString(),custo:"0,00"})}m(g.length?g:[{codigo:"",quantidade:"",custo:""}]),p(a=>({...a,acrescimo:0})),o(a=>({...a,custo:"0"})),e(!1)},[a,b,m]);(0,c.useEffect)(()=>{H()},[H]);let I=(0,c.useCallback)(async()=>{if(!a||!b)return{error:null};let c="SB"===b?"marketplace_tray_sb":"marketplace_tray_pk";return g(!0),await E.supabase.from(c).update({Loja:h.loja,"ID Bling":h.id_bling,"ID Tray":h.id_tray,"ID Var":h.id_var,OD:h.od,Referência:h.referencia,Tipo:h.tipo_anuncio,Nome:h.nome,Marca:h.marca,Categoria:h.categoria,Peso:h.peso,Altura:h.altura,Largura:h.largura,Comprimento:h.comprimento,Embalagem:h.embalagem,Desconto:j.desconto,Imposto:j.imposto,"Margem de Lucro":j.margem,Frete:j.frete,Comissão:j.comissao,Marketing:j.marketing}).eq("ID Tray",h.id_tray),await E.supabase.from("anuncios_all").update({OD:h.od,Peso:h.peso,Altura:h.altura,Largura:h.largura,Comprimento:h.comprimento}).or(`ID Var.eq.${h.id_var},ID Tray.eq.${h.id_tray},ID Bling.eq.${h.id_bling}`),g(!1),{}},[a,b,h,j]);return{loading:d,saving:f,produto:h,setProduto:i,calculoLoja:j,setCalculoLoja:k,composicao:l,setComposicao:m,custoTotal:n,adicionarItem:q,removerItem:r,save:I,campoAtivo:u,sugestoes:s,indiceSelecionado:w,inputRefs:z,listaRef:y,buscarSugestoes:B,handleSugestoesKeys:(a,b)=>{if(s.length){if("ArrowDown"===a.key&&(a.preventDefault(),x(a=>a<s.length-1?a+1:0)),"ArrowUp"===a.key&&(a.preventDefault(),x(a=>a>0?a-1:s.length-1)),"Enter"===a.key){a.preventDefault();let c=s[w];C(c.codigo,c.custo,b)}"Escape"===a.key&&(a.preventDefault(),t([]),v(null))}},selecionarSugestao:C}}(g,"Pikot Shop"===i?"PK":"Sóbaquetas"===i?"SB":i||""),H=(()=>{if(!r)return 0;let a=Number(r||0),b=a=>parseFloat(String(a).replace(",","."))||0,c=b(s.desconto)/100,d=b(s.imposto)/100,e=b(s.margem)/100,f=b(s.comissao)/100,g=b(s.marketing)/100,h=b(s.frete),i=1-(d+e+f+g),j=i>0?(a*(1-c)+h+2.5)/i:0;return isFinite(j)?j:0})();return(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0a] via-[#0f0f0f] to-[#0a0a0a] p-4 md:p-8 pt-24",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4",children:[(0,b.jsx)(d.motion.div,{className:"lg:col-span-7 p-2 rounded-xl bg-white/5 border border-white/10 backdrop-blur-lg shadow-lg h-full flex flex-col gap-3",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(e.Layers,{className:"w-5 h-5 text-[#1a8ceb]"}),(0,b.jsx)("h3",{className:"text-base font-bold text-white",children:"Composição"})]}),(0,b.jsx)(q,{composicao:m,adicionarItem:o,removerItem:p,setComposicao:n,campoAtivo:u,sugestoes:v,indiceSelecionado:w,inputRefs:x,listaRef:z,buscarSugestoes:B,handleSugestoesKeys:C,selecionarSugestao:G}),(0,b.jsxs)("div",{className:"mt-3 p-3 bg-gradient-to-br from-[#1a8ceb]/20 to-[#1a8ceb]/5 rounded-xl border border-[#1a8ceb]/30 text-center",children:[(0,b.jsx)("span",{className:"text-neutral-300 text-xs",children:"Custo Total"}),(0,b.jsxs)("div",{className:"text-xl font-bold text-white",children:["R$ ",(0,b.jsx)(j,{value:Number(r||0)})]})]})]})}),(0,b.jsxs)(d.motion.div,{className:"lg:col-span-5 p-2 rounded-xl bg-white/5 border border-white/10 backdrop-blur-lg shadow-lg flex flex-col gap-3 h-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[(0,b.jsx)(y,{calculoLoja:s,setCalculoLoja:t,precoLoja:H,produto:k,saving:!1,handleClearLocal:()=>{window.confirm("Tem certeza?")&&(l(a=>({...a,referencia:"",nome:"",marca:"",categoria:"",peso:"",altura:"",largura:"",comprimento:""})),n([{codigo:"",quantidade:"",custo:""}]))}}),(0,b.jsx)(A,{produto:k,setProduto:l})]})]}),(0,b.jsx)(D,{produto:k,setProduto:l})]})}function H(){return(0,b.jsx)(c.Suspense,{fallback:null,children:(0,b.jsx)(G,{})})}a.s(["default",()=>H,"dynamic",0,"force-dynamic"],67208)}];

//# sourceMappingURL=src_app_dashboard_marketplaces_tray_details_page_tsx_dba56844._.js.map