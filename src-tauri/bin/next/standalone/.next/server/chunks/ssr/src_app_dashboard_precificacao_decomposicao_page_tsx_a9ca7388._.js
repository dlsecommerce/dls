module.exports=[88281,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(74167),e=a.i(17545),f=a.i(49447),g=a.i(15618),h=a.i(33508),i=a.i(66718),j=a.i(70430),k=a.i(94202);let l=({text:a})=>(0,b.jsxs)("div",{className:"relative group flex items-center",children:[(0,b.jsx)(f.HelpCircle,{className:"w-4 h-4 text-neutral-400 cursor-pointer"}),(0,b.jsx)("div",{className:"absolute left-6 top-1/2 -translate-y-1/2 text-neutral-400/70 text-xs font-normal whitespace-nowrap opacity-0 group-hover:opacity-100 transition pointer-events-none z-20",children:a})]});function m({composicao:a,setComposicao:d,codeRefs:f,qtyRefs:m,costRefs:n,listaRef:o,campoAtivo:p,setCampoAtivo:q,indiceSelecionado:r,setIndiceSelecionado:s,sugestoes:t,buscarSugestoes:u,selecionarSugestao:v,autoSelecionarPrimeiro:w,handleKeyDownCodigo:x,handleKeyDownQuantidade:z,onBlurQuantidade:A,onBlurCusto:B,adicionarItem:C}){var D;let E,F=c.default.useRef((D=(a,b)=>u(a,b),(...a)=>{clearTimeout(E),E=setTimeout(()=>D(...a),10)})).current,G=c.default.useRef(!1),H=a.length>10?"max-h-[360px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-[#1a8ceb]/30 scrollbar-track-transparent":"";return(0,b.jsxs)("div",{className:"lg:col-span-7 p-3 rounded-xl bg-white/5 border border-white/10 backdrop-blur-lg shadow-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(e.Layers,{className:"w-5 h-5 text-[#1a8ceb]"}),(0,b.jsxs)("h3",{className:"text-base font-bold text-white flex items-center gap-2",children:["Composição",(0,b.jsx)(l,{text:"Composição de Custos."})]})]}),(0,b.jsx)("div",{className:`space-y-1 ${H}`,children:a.map((c,e)=>(0,b.jsxs)("div",{className:"relative grid grid-cols-3 gap-2 mb-1 p-2 rounded-lg bg-black/30 border border-white/10",children:[e>0&&(0,b.jsx)("button",{onClick:()=>{d(a=>a.filter((a,b)=>b!==e))},className:"absolute -top-1 -right-1 w-5 h-5 p-0 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-full flex items-center justify-center transition-all",children:(0,b.jsx)(h.X,{className:"w-3 h-3"})}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(j.Label,{className:"text-neutral-400 text-[10px] block mb-1",children:"Código"}),(0,b.jsx)(i.Input,{ref:a=>f.current[e]=a,value:c.codigo,placeholder:"SKU",onChange:b=>{let c=[...a];c[e].codigo=b.target.value,d(c),F(b.target.value,e)},onKeyDown:a=>x(a,e),onBlur:()=>{G.current||w(e)},className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]"}),p===e&&t.length>0&&(0,b.jsx)("div",{ref:o,className:"absolute z-50 mt-1 bg-[#0f0f0f] border border-white/10 rounded-md shadow-lg w-full max-h-40 overflow-y-auto",children:t.map((a,c)=>(0,b.jsxs)("div",{className:`px-2 py-1 text-xs flex justify-between cursor-pointer ${c===r?"bg-[#1a8ceb]/30":"hover:bg-[#1a8ceb]/20"}`,onClick:()=>v(a.codigo,a.custo,e),children:[(0,b.jsx)("span",{className:"text-white",children:a.codigo}),(0,b.jsxs)("span",{className:"text-[#1a8ceb]",children:["R$ ",y(a.custo)]})]},c))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-neutral-400 text-[10px] block mb-1",children:"Quantidade"}),(0,b.jsx)(i.Input,{ref:a=>m.current[e]=a,value:c.quantidade,placeholder:"1",onChange:b=>{let c=[...a];c[e].quantidade=b.target.value,d(c)},onBlur:()=>A(e),onKeyDown:a=>z(a,e),className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-neutral-400 text-[10px] block mb-1",children:"Custo (R$)"}),(0,b.jsx)(i.Input,{ref:a=>n.current[e]=a,value:c.custo,placeholder:"0,00",onChange:b=>{let c=[...a];c[e].custo=b.target.value,d(c)},onBlur:()=>{G.current||B(e)},onKeyDown:b=>((b,c)=>{if("Tab"===b.key||"Enter"===b.key){b.preventDefault();let e=a[c],g=e.codigo.trim().length>0,h=e.quantidade.trim().length>0,i=e.custo.trim().length>0,j=c===a.length-1;if(G.current=!0,j&&g&&h&&i){d(a=>[...a,{codigo:"",quantidade:"",custo:""}]),setTimeout(()=>{G.current=!1,f.current[c+1]?.focus()},0);return}setTimeout(()=>{G.current=!1,f.current[c+1]?.focus()},0);return}})(b,e),className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]"})]})]},e))}),(0,b.jsxs)(k.Button,{onClick:C,variant:"outline",className:"w-full border-white/10 text-white text-xs hover:bg-white/5 hover:border-[#1a8ceb]/50 rounded-xl transition-all mt-2",children:[(0,b.jsx)(g.Plus,{className:"w-3 h-3 mr-2"})," Incluir Custos"]})]})}var n=a.i(46271),o=a.i(90166),p=a.i(84505),q=a.i(81560),r=a.i(70362),s=a.i(70179);let t=({text:a})=>(0,b.jsxs)("div",{className:"relative group flex items-center",children:[(0,b.jsx)(f.HelpCircle,{className:"w-4 h-4 text-neutral-400 cursor-pointer"}),(0,b.jsx)("div",{className:"absolute left-6 top-1/2 -translate-y-1/2 text-neutral-400/70 text-xs whitespace-nowrap font-normal opacity-0 group-hover:opacity-100 transition pointer-events-none z-20",children:a})]});function u({precoVenda:a,setPrecoVenda:d,onBlurPrecoVenda:e,composicao:f,setComposicao:g,resultados:h,setResultados:k}){let[l,m]=(0,c.useState)(!1),[u,v]=(0,c.useState)(0);return(0,c.useEffect)(()=>{if(0===u)return;let a=setTimeout(()=>v(0),5e3);return()=>clearTimeout(a)},[u]),(0,b.jsxs)("div",{className:"mb-3 relative",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(o.DollarSign,{className:"w-5 h-5 text-[#1a8ceb]"}),(0,b.jsxs)("h3",{className:"text-white text-sm font-semibold flex items-center gap-2",children:["Preço de Venda",(0,b.jsx)(t,{text:"Preço de Venda Total."})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(n.motion.button,{whileTap:{scale:.9},onClick:()=>{let b=new Date,c=b.toLocaleDateString("pt-BR").replace(/\//g,"-"),d=`${b.getHours().toString().padStart(2,"0")}h${b.getMinutes().toString().padStart(2,"0")}m`,e=`DECOMPOSI\xc7\xc3O_${c}_${d}.xlsx`,g=[["Preço de Venda (R$)",a||"0,00"],[],["Código","Quantidade","Custo (R$)"],...f.map(a=>[a.codigo||"",a.quantidade||"",a.custo||""])],i=r.utils.aoa_to_sheet(g),j=[["Resultados Calculados"],["Gerado em",b.toLocaleString("pt-BR")],[],["Código","Unitário (R$)","Total (R$)"],...h.map(a=>[a.codigo,a.unitFmt,a.totalFmt])],k=r.utils.aoa_to_sheet(j),l={fill:{type:"pattern",patternType:"solid",fgColor:{rgb:"1A8CEB"}},font:{bold:!0,color:{rgb:"FFFFFF"},sz:11},border:{top:{style:"thin",color:{rgb:"FFFFFF"}},bottom:{style:"thin",color:{rgb:"FFFFFF"}},left:{style:"thin",color:{rgb:"FFFFFF"}},right:{style:"thin",color:{rgb:"FFFFFF"}}},alignment:{horizontal:"center",vertical:"center"}},m=(a,b)=>{["A","B","C"].forEach(c=>{let d=`${c}${b}`;a[d]&&(a[d].s=l)})};m(i,3),m(k,4),i["!cols"]=[{wch:18},{wch:15},{wch:15}],k["!cols"]=[{wch:18},{wch:18},{wch:18}];let n=r.utils.book_new();r.utils.book_append_sheet(n,i,"Composição"),r.utils.book_append_sheet(n,k,"Resultados");let o=new Blob([r.write(n,{bookType:"xlsx",type:"array",cellStyles:!0})],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,s.saveAs)(o,e)},title:"Baixar planilha Excel",className:"p-2 hover:bg-white/10 rounded-full transition-all",children:(0,b.jsx)(p.Download,{className:"w-4 h-4 text-white opacity-70 hover:opacity-100"})}),(0,b.jsx)(n.motion.button,{whileTap:{scale:.9,rotate:-15},onClick:()=>{v(a=>{let b=a+1;return b<5?(m(!0),d(""),g([]),k([]),setTimeout(()=>m(!1),300)):(m(!0),console.warn("Botão de limpar bloqueado após 5 cliques.")),b})},disabled:l&&u>=5,title:u>=5?"Botão bloqueado temporariamente após muitos cliques":"Limpar todos os dados",className:`p-2 rounded-full transition-all ${l?"bg-red-500/20 text-red-300 cursor-not-allowed":"hover:bg-red-500/10 text-red-400 hover:text-red-500"}`,children:(0,b.jsx)(q.Trash2,{className:`w-4 h-4 transition-transform ${l?"animate-pulse":""}`})})]})]}),(0,b.jsx)(i.Input,{value:a,placeholder:"0,00",onChange:a=>d(a.target.value),onBlur:e,className:"bg-black/50 border-white/10 text-white text-xs rounded-md focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]"}),(0,b.jsx)(j.Label,{className:"text-neutral-400 text-[10px] mt-1 block",children:"Digite o preço final da venda"})]})}var v=a.i(24669);let w=({text:a})=>(0,b.jsxs)("div",{className:"relative group flex items-center",children:[(0,b.jsx)(f.HelpCircle,{className:"w-4 h-4 text-neutral-400 cursor-pointer"}),(0,b.jsx)("div",{className:"absolute left-6 top-1/2 -translate-y-1/2 text-neutral-400/70 text-xs font-normal whitespace-nowrap opacity-0 group-hover:opacity-100 transition pointer-events-none z-20",children:a})]});function x({resultados:a,composicao:c,precoVenda:d,enableScroll:e}){let f=c.length>0?c:[{codigo:"",quantidade:"",custo:""}],g=c.length>=10?"max-h-[420px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-[#1a8ceb]/30 scrollbar-track-transparent":"";return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(v.TrendingUp,{className:"w-5 h-5 text-[#1a8ceb]"}),(0,b.jsxs)("h3",{className:"text-base font-bold text-white flex items-center gap-2",children:["Resultados",(0,b.jsx)(w,{text:"Resultados do Preço de Venda."})]})]})}),(0,b.jsx)("div",{className:g,children:f.map((c,d)=>{let e=a[d],f=e?.hasCost??!!c.custo;return(0,b.jsxs)("div",{className:`p-2 rounded-lg border mb-2 transition-colors ${f?"bg-[#1a8ceb]/10 border-[#1a8ceb]/30":"bg-black/30 border-white/10"}`,children:[(0,b.jsx)("span",{className:"text-white text-xs block mb-1",children:c.codigo||"SKU"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-neutral-300 text-[10px] block mb-1",children:"Unitário (R$)"}),(0,b.jsx)(i.Input,{value:e?.unitFmt||"",placeholder:"0,00",readOnly:!0,className:`text-xs rounded-md bg-black/50 text-white ${f?"border-[#1a8ceb]/50 focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]":"border-white/10 focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]"}`})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-neutral-300 text-[10px] block mb-1",children:"Total (R$)"}),(0,b.jsx)(i.Input,{value:e?.totalFmt||"",placeholder:"0,00",readOnly:!0,className:`text-xs rounded-md bg-black/50 text-white ${f?"border-[#1a8ceb]/50 focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]":"border-white/10 focus:border-[#1a8ceb] focus:ring-2 focus:ring-[#1a8ceb]"}`})]})]})]},d)})})]})}let y=a=>Number.isFinite(a)?a.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):"",z=a=>{if(!a)return 0;let b=a.toString().trim();b.includes(",")&&b.includes(".")?b=b.replace(/\./g,"").replace(",","."):b.includes(",")&&(b=b.replace(",","."));let c=parseFloat(b);return Number.isFinite(c)?c:0};function A(){let[a,e]=(0,c.useState)(""),[f,g]=(0,c.useState)([{codigo:"",quantidade:"",custo:""}]),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(null),[l,n]=(0,c.useState)(-1),o=(0,c.useRef)(null),p=(0,c.useRef)([]),q=(0,c.useRef)([]),r=(0,c.useRef)([]),s=(0,c.useMemo)(()=>f.reduce((a,b)=>a+z(b.quantidade)*z(b.custo),0),[f]),t=(0,c.useMemo)(()=>{let b=z(a);return f.map(a=>{let c=z(a.quantidade),d=z(a.custo);if(!a.codigo||0===s)return{unit:0,total:0,hasCost:d>0};let e=c*d/s*b;return{unit:c>0?e/c:0,total:e,hasCost:d>0}})},[f,s,a]),v=async(a,b)=>{if(!a.trim())return void i([]);let{data:c,error:e}=await d.supabase.from("custos").select('"Código", "Custo Atual"').ilike('"Código"',`%${a}%`).limit(5);e?console.error("Erro Supabase:",e):(k(b),i(c?.map(a=>({codigo:a["Código"],custo:Number(a["Custo Atual"])||0}))||[]),n(-1))},w=(a,b,c)=>{let d=[...f];d[c].codigo=a,d[c].custo=y(b),g(d),i([]),k(null),n(-1),setTimeout(()=>q.current[c]?.focus(),0)},A=async a=>{let b=f[a]?.codigo?.trim();if(!b)return;if(h.length>0){let b=h[0];w(b.codigo,b.custo,a);return}let{data:c}=await d.supabase.from("custos").select('"Código", "Custo Atual"').ilike('"Código"',`%${b}%`).limit(1);if(c&&c.length>0){let b={codigo:c[0]["Código"],custo:Number(c[0]["Custo Atual"])||0};w(b.codigo,b.custo,a)}};(0,c.useEffect)(()=>{let a=a=>{if(null===j)return;let b=o.current,c=p.current[j],d=a.target;b?.contains(d)||c?.contains(d)||(A(j),i([]),k(null),n(-1))};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[j,h]);let B=(a,b,c)=>{let d="down"===c?b+1:b-1;d>=0&&a.current[d]&&a.current[d].focus()},C=(a,b,c)=>{"right"===b?"code"===c?q.current[a]?.focus():"qty"===c?r.current[a]?.focus():"cost"===c&&p.current[a+1]?.focus():"cost"===c?q.current[a]?.focus():"qty"===c?p.current[a]?.focus():"code"===c&&r.current[a-1]&&r.current[a-1].focus()},D=f.filter(a=>a.codigo.trim()).map((a,b)=>{let c=t[b]||{unit:0,total:0,hasCost:!1};return{codigo:a.codigo,unitFmt:c.unit?y(c.unit):"",totalFmt:c.total?y(c.total):"",hasCost:c.hasCost}}),E=D.length>10;return(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0a] via-[#0f0f0f] to-[#0a0a0a] p-4 md:p-8 pt-20",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4",children:[(0,b.jsx)(m,{composicao:f,setComposicao:g,codeRefs:p,qtyRefs:q,costRefs:r,listaRef:o,campoAtivo:j,setCampoAtivo:k,indiceSelecionado:l,setIndiceSelecionado:n,sugestoes:h,buscarSugestoes:v,selecionarSugestao:w,autoSelecionarPrimeiro:A,handleKeyDownCodigo:(a,b)=>{if(h.length){if("ArrowDown"===a.key||"ArrowUp"===a.key){a.preventDefault(),n(b=>"ArrowDown"===a.key?(b+1)%h.length:(b-1+h.length)%h.length);return}if("Enter"===a.key&&l>=0){a.preventDefault();let c=h[l];w(c.codigo,c.custo,b);return}}if("Tab"===a.key||"Enter"===a.key){a.preventDefault(),A(b).then(()=>q.current[b]?.focus());return}if("ArrowDown"===a.key){a.preventDefault(),B(p,b,"down");return}if("ArrowUp"===a.key){a.preventDefault(),B(p,b,"up");return}if("ArrowRight"===a.key){a.preventDefault(),C(b,"right","code");return}if("ArrowLeft"===a.key){a.preventDefault(),C(b,"left","code");return}},handleKeyDownQuantidade:(a,b)=>{if("Tab"===a.key||"Enter"===a.key){a.preventDefault(),r.current[b]?.focus();return}if("ArrowDown"===a.key||"ArrowUp"===a.key){a.preventDefault(),B(q,b,"ArrowDown"===a.key?"down":"up");return}if("ArrowRight"===a.key||"ArrowLeft"===a.key){a.preventDefault(),C(b,"ArrowRight"===a.key?"right":"left","qty");return}},handleKeyDownCusto:(a,b)=>{if("Tab"===a.key||"Enter"===a.key){a.preventDefault();let c=b===f.length-1,d=z(f[b].custo)>0,e=f[b].codigo.trim().length>0;c&&(d||e)?(g(a=>[...a,{codigo:"",quantidade:"",custo:""}]),setTimeout(()=>p.current[b+1]?.focus(),0)):p.current[b+1]?.focus();return}if("ArrowDown"===a.key||"ArrowUp"===a.key){a.preventDefault(),B(r,b,"ArrowDown"===a.key?"down":"up");return}if("ArrowRight"===a.key||"ArrowLeft"===a.key){a.preventDefault(),C(b,"ArrowRight"===a.key?"right":"left","cost");return}},onBlurQuantidade:a=>{let b=z(f[a].quantidade),c=[...f];c[a].quantidade=b?y(b):"",g(c)},onBlurCusto:a=>{let b=z(f[a].custo),c=[...f];c[a].custo=b?y(b):"",g(c),a===f.length-1&&b>0&&f[a].codigo.trim()&&g(a=>[...a,{codigo:"",quantidade:"",custo:""}])},adicionarItem:()=>g(a=>[...a,{codigo:"",quantidade:"",custo:""}])}),(0,b.jsxs)("div",{className:"lg:col-span-5 p-3 rounded-xl bg-white/5 border border-white/10 backdrop-blur-lg shadow-lg",children:[(0,b.jsx)(u,{precoVenda:a,setPrecoVenda:e,onBlurPrecoVenda:()=>{let b=z(a);e(b?y(b):"")},composicao:f,setComposicao:g,resultados:D,setResultados:()=>{}}),(0,b.jsx)(x,{resultados:D,composicao:f,precoVenda:a,enableScroll:E,onDownloadExcel:a=>{},limparTudo:()=>{g([{codigo:"",quantidade:"",custo:""}])}})]})]})})}function B(){return(0,b.jsx)(A,{})}a.s(["default",()=>B],88281)}];

//# sourceMappingURL=src_app_dashboard_precificacao_decomposicao_page_tsx_a9ca7388._.js.map